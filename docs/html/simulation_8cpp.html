<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>exprob_ass2: src/simulation.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">exprob_ass2
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Package for the second assignment of the course experimental robotics laboratory</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">simulation.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>this node implements the rviz configuration and it generates and pubblish the hints of the game.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;ros/ros.h&gt;</code><br />
<code>#include &lt;gazebo_msgs/LinkStates.h&gt;</code><br />
<code>#include &lt;visualization_msgs/MarkerArray.h&gt;</code><br />
<code>#include &lt;exprob_ass2/ErlOracle.h&gt;</code><br />
<code>#include &lt;exprob_ass2/Oracle.h&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for simulation.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="simulation_8cpp__incl.png" border="0" usemap="#src_2simulation_8cpp" alt=""/></div>
<map name="src_2simulation_8cpp" id="src_2simulation_8cpp">
<area shape="rect" title="this node implements the rviz configuration and it generates and pubblish the hints of the game." alt="" coords="633,5,775,32"/>
<area shape="rect" title=" " alt="" coords="233,177,311,203"/>
<area shape="rect" title=" " alt="" coords="31,87,225,114"/>
<area shape="rect" title=" " alt="" coords="249,80,396,121"/>
<area shape="rect" title=" " alt="" coords="420,87,599,114"/>
<area shape="rect" href="oracle_8h_source.html" title=" " alt="" coords="623,87,785,114"/>
<area shape="rect" title=" " alt="" coords="809,87,889,114"/>
<area shape="rect" title=" " alt="" coords="914,87,985,114"/>
<area shape="rect" title=" " alt="" coords="1009,87,1073,114"/>
<area shape="rect" title=" " alt="" coords="1098,87,1161,114"/>
<area shape="rect" title=" " alt="" coords="613,169,795,211"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7e333af55a708cf53de07126dcd3006b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulation_8cpp.html#a7e333af55a708cf53de07126dcd3006b">distfromtarget</a> (double x, double y, double z, double x1, double y1, double z1)</td></tr>
<tr class="memdesc:a7e333af55a708cf53de07126dcd3006b"><td class="mdescLeft">&#160;</td><td class="mdescRight">compute the distance between 3D points  <a href="simulation_8cpp.html#a7e333af55a708cf53de07126dcd3006b">More...</a><br /></td></tr>
<tr class="separator:a7e333af55a708cf53de07126dcd3006b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a018a8b62df58344a7e1d62c6b3f6df30"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulation_8cpp.html#a018a8b62df58344a7e1d62c6b3f6df30">oracleService</a> (exprob_ass2::Oracle::Request &amp;req, exprob_ass2::Oracle::Response &amp;res)</td></tr>
<tr class="memdesc:a018a8b62df58344a7e1d62c6b3f6df30"><td class="mdescLeft">&#160;</td><td class="mdescRight">provides a service to check the winning ID  <a href="simulation_8cpp.html#a018a8b62df58344a7e1d62c6b3f6df30">More...</a><br /></td></tr>
<tr class="separator:a018a8b62df58344a7e1d62c6b3f6df30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a876a1245db85a2bb87c08ae086f1eafa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulation_8cpp.html#a876a1245db85a2bb87c08ae086f1eafa">oracleCallback</a> (const gazebo_msgs::LinkStates::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:a876a1245db85a2bb87c08ae086f1eafa"><td class="mdescLeft">&#160;</td><td class="mdescRight">callback for the subscriber to gazebo/link_states  <a href="simulation_8cpp.html#a876a1245db85a2bb87c08ae086f1eafa">More...</a><br /></td></tr>
<tr class="separator:a876a1245db85a2bb87c08ae086f1eafa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulation_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">main function of the <a class="el" href="simulation_8cpp.html" title="this node implements the rviz configuration and it generates and pubblish the hints of the game.">simulation.cpp</a> node  <a href="simulation_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a32812fe000700d7aa8988d74e59471c7"><td class="memItemLeft" align="right" valign="top"><a id="a32812fe000700d7aa8988d74e59471c7"></a>
ros::Publisher&#160;</td><td class="memItemRight" valign="bottom"><b>oracle_pub</b></td></tr>
<tr class="separator:a32812fe000700d7aa8988d74e59471c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36b0204cd96e3dc326a2adfa3d1dceda"><td class="memItemLeft" align="right" valign="top"><a id="a36b0204cd96e3dc326a2adfa3d1dceda"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>markx</b> [4]</td></tr>
<tr class="separator:a36b0204cd96e3dc326a2adfa3d1dceda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bc4146f286fe42bd5e8fa1e53826447"><td class="memItemLeft" align="right" valign="top"><a id="a0bc4146f286fe42bd5e8fa1e53826447"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>marky</b> [4]</td></tr>
<tr class="separator:a0bc4146f286fe42bd5e8fa1e53826447"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d90002e6a9c50028f184b22c380efc4"><td class="memItemLeft" align="right" valign="top"><a id="a8d90002e6a9c50028f184b22c380efc4"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>markz</b> [4]</td></tr>
<tr class="separator:a8d90002e6a9c50028f184b22c380efc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a412ed4d68a81f370cdcd20e3019db982"><td class="memItemLeft" align="right" valign="top"><a id="a412ed4d68a81f370cdcd20e3019db982"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>lastmarkx</b> = 0.0</td></tr>
<tr class="separator:a412ed4d68a81f370cdcd20e3019db982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a174c0dfc727a92493b03f7b0573f4f3e"><td class="memItemLeft" align="right" valign="top"><a id="a174c0dfc727a92493b03f7b0573f4f3e"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>lastmarky</b> = 0.0</td></tr>
<tr class="separator:a174c0dfc727a92493b03f7b0573f4f3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0049a8a39c319bf1470f36c9e0f75abd"><td class="memItemLeft" align="right" valign="top"><a id="a0049a8a39c319bf1470f36c9e0f75abd"></a>
const std::string&#160;</td><td class="memItemRight" valign="bottom"><b>key</b> [3] = {&quot;who&quot;, &quot;what&quot;, &quot;where&quot;}</td></tr>
<tr class="separator:a0049a8a39c319bf1470f36c9e0f75abd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68fa6a0c7a1208892294604263e23d92"><td class="memItemLeft" align="right" valign="top"><a id="a68fa6a0c7a1208892294604263e23d92"></a>
const std::string&#160;</td><td class="memItemRight" valign="bottom"><b>person</b> [6] = {&quot;missScarlett&quot;, &quot;colonelMustard&quot;, &quot;mrsWhite&quot;, &quot;mrGreen&quot;, &quot;mrsPeacock&quot;, &quot;profPlum&quot;}</td></tr>
<tr class="separator:a68fa6a0c7a1208892294604263e23d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4368e40a20e72e62974037baf19dba80"><td class="memItemLeft" align="right" valign="top"><a id="a4368e40a20e72e62974037baf19dba80"></a>
const std::string&#160;</td><td class="memItemRight" valign="bottom"><b>object</b> [6] = {&quot;candlestick&quot;, &quot;dagger&quot;, &quot;leadPipe&quot;, &quot;revolver&quot;, &quot;rope&quot;, &quot;spanner&quot;}</td></tr>
<tr class="separator:a4368e40a20e72e62974037baf19dba80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e5bd50ead53d20df3f8ede527f47ce7"><td class="memItemLeft" align="right" valign="top"><a id="a5e5bd50ead53d20df3f8ede527f47ce7"></a>
const std::string&#160;</td><td class="memItemRight" valign="bottom"><b>place</b> [9] = {&quot;conservatory&quot;, &quot;lounge&quot;, &quot;kitchen&quot;, &quot;library&quot;, &quot;hall&quot;, &quot;study&quot;, &quot;bathroom&quot;, &quot;diningRoom&quot;, &quot;billiardRoom&quot;}</td></tr>
<tr class="separator:a5e5bd50ead53d20df3f8ede527f47ce7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37d4a0b625b8b9583adf9362f5aae971"><td class="memItemLeft" align="right" valign="top"><a id="a37d4a0b625b8b9583adf9362f5aae971"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>uIDs</b> [3] ={-1,-1,-1}</td></tr>
<tr class="separator:a37d4a0b625b8b9583adf9362f5aae971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90c5d03e068ddae91702223f47eff712"><td class="memItemLeft" align="right" valign="top"><a id="a90c5d03e068ddae91702223f47eff712"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>winID</b> = -1</td></tr>
<tr class="separator:a90c5d03e068ddae91702223f47eff712"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6ebafb401d03bc71a4611527ec644a0"><td class="memItemLeft" align="right" valign="top"><a id="ab6ebafb401d03bc71a4611527ec644a0"></a>
std::vector&lt; exprob_ass2::ErlOracle &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>oracle_msgs</b></td></tr>
<tr class="separator:ab6ebafb401d03bc71a4611527ec644a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>this node implements the rviz configuration and it generates and pubblish the hints of the game. </p>
<dl class="section author"><dt>Author</dt><dd>Serena Paneri </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>26/11/2022</dd></dl>
<p>Subscribes to: <br  />
 /gazebo/link_states</p>
<p>Publishes to: <br  />
 /visualization_marker /oracle_hint</p>
<p>Serivces: <br  />
 /oracle_solution</p>
<p>Client Services: <br  />
 None</p>
<p>Action Services: <br  />
 None</p>
<p>Description: <br  />
 In this node is implemented the behavior of the simulation environment. Indeed there is a subscriber to know the position of the robot's links. There is a publisher that allows to visualize the spheric markers in the simulation environment, and those markers corresponds to the place where the hints are recieved. There is another publisher that sends the hint message if and only if the cluedo_link of the robot is closed enough to the spheric marker. And finally there is a service whose aim is to check if the current ID coincides with the winning ID of the game. This node handles both the generation of hints, both malformed and correct one, that are generated randomly from arrays containing the individuals of the game, and also the creation of the simulated environment composed of spheric markers, that are places in four specific places in the simulation environment and that can be found (randomly) at two different z coordinates. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7e333af55a708cf53de07126dcd3006b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e333af55a708cf53de07126dcd3006b">&#9670;&nbsp;</a></span>distfromtarget()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double distfromtarget </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>y1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>compute the distance between 3D points </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>x coordinate of the actual position </td></tr>
    <tr><td class="paramname">y</td><td>y coordinate of the actual position </td></tr>
    <tr><td class="paramname">z</td><td>z coordinate of the actual position </td></tr>
    <tr><td class="paramname">x1</td><td>x coordinate of the target position </td></tr>
    <tr><td class="paramname">y1</td><td>y coordinate of the target position </td></tr>
    <tr><td class="paramname">z1</td><td>z coordinate of the target position </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dist: distance computed between 3D points</dd></dl>
<p>This function computes the distance between the actual 3D position and the 3D position of the target. </p>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main function of the <a class="el" href="simulation_8cpp.html" title="this node implements the rviz configuration and it generates and pubblish the hints of the game.">simulation.cpp</a> node </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td></td></tr>
    <tr><td class="paramname">argv</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0</dd></dl>
<p>This is the main function of the node where the node itself is initialized. Moreover, here are implemented a publisher, in order to visualize through spheric markers the sources points where the hints are generated, another publisher which is in charge of publishing the hints of the game when the cluedo_link of the robot approaches the spheric marker, a subscriber to know the links' position of the robot and a service that has top check if the ID of the current hypothesis coincides with the winning one. In addition the markers in the environment are imlplemented and displayed in the simulated enviornment, and the winning ID is chosen. </p>

</div>
</div>
<a id="a876a1245db85a2bb87c08ae086f1eafa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a876a1245db85a2bb87c08ae086f1eafa">&#9670;&nbsp;</a></span>oracleCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oracleCallback </td>
          <td>(</td>
          <td class="paramtype">const gazebo_msgs::LinkStates::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>callback for the subscriber to gazebo/link_states </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message from the /gazebo/link_states </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None</dd></dl>
<p>This is the callback function for the subscriber to the gazebo/link_states topic. If the link of the robot cluedo_link is closed enough to the 'hint generator', so the distance between the cluedo_link and the 'hint generator' is less than a certain threshold, that in this case is of 0,25 m, it generates a random hint that could be a malformed hint, or it could contain a correct hint composed by the ID, the key (so, who, what, where), and the value (so, the individual). </p>

</div>
</div>
<a id="a018a8b62df58344a7e1d62c6b3f6df30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a018a8b62df58344a7e1d62c6b3f6df30">&#9670;&nbsp;</a></span>oracleService()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool oracleService </td>
          <td>(</td>
          <td class="paramtype">exprob_ass2::Oracle::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">exprob_ass2::Oracle::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>provides a service to check the winning ID </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>request from the client </td></tr>
    <tr><td class="paramname">res</td><td>response from the service oracle_solution </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true</dd></dl>
<p>This function checks if the ID of the current hypothesis is the winning one. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
